function [F] = feedback_control2(Ac, Bc, Ak, Bk, sc, sd)
%%%%%%%%%%%%%%%%%%%%%%  DOC HELP  %%%%%%%%%%%%%%%%%%%%%%
%% Inputs
%
%   Ac  : A(s) in continuous form  -- 4x4
%   Bc  : B(s) in continuous form  -- 4x1
%   Ak  : A(s) in discrete form    -- 4x4
%   Bk  : B(s) in discrete form    -- 4x1
%   sc  : current state vector     -- 4x1
%   sd  : desired state vector     -- 4x1
%
%% Outputs
%   F   : Feedback control gain    -- 1x4
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



% A = [1,    0.03333333,    0,            0;
%      0,    1,             -0.06,  0;
%      0,    0,             1,            0.03333333;
%      0,    0,             0.89,   1        ];
% 
% 
% B = [0; 0.03341688; 0; -0.0783208];



% SP = [10.5601248150183	5.36061383272941	12.6569241669786	2.79799040101679;
%        5.36061383272941	3.21709537638948	7.72529599087359	1.71235836993648;  
%        12.6569241669786	7.72529599087359	20.8321029087349	4.29612650452707;
%        2.79799040101679	1.71235836993648	4.29612650452707	0.958745854480268];


SP = [11.7610, 6.1422, 14.7641, 3.1142;
      6.1422, 3.8248, 9.3641, 1.9903;
      14.7641, 9.3641, 25.9514, 5.0703;
      3.1142, 1.9903, 5.0703, 1.0949];

% A2 = [1	0.0166666666666667	0	0;
%      0	1	-0.0282455903201080	0;
%      0	0	1	0.0166666666666667;
%      0	0	0.449013005410375	1];
% 
% B2 = [0;
%       0.0167084348716417;
%       0;
%     -0.0391603746502148];
% 
% P2 = [2.75094110803732	1.06292771456379	3.05159866452081	0.641996583286987;
%       1.06292771456379	0.898973884948197	2.38202789769940	0.502407959239469;
%       3.05159866452081	2.38202789769940	9.08327478948450	1.58946919395285;
%       0.641996583286987	0.502407959239469	1.58946919395285	0.385338261638770];

beta1 = 0.0004;
% beta1 = 0.0015;

eta = 1.1;
% beta = 0.95;
beta = 0.95;
% kappa = 0.012;
kappa = 0.02;

setlmis([]) 
Q = lmivar(1,[4 1]); 
R = lmivar(2,[1 4]);
 
lmiterm([1 1 1 Q], eye(4), SP);
lmiterm([1 1 1 0], -eye(4));

lmiterm([-2 1 1 Q], eta*eye(4), SP);
lmiterm([-2 1 1 0], -eye(4));

lmiterm([-3 1 1 Q],1,1);

lmiterm([-4 1 1 Q],1,(beta - 2*eta*kappa)*eye(4));
lmiterm([-4 2 1 Q],Ak,1);
lmiterm([-4 2 1 R],Bk,1);
lmiterm([-4 2 2 Q],1,1);

lmiterm([-5 1 1 Q],1,1);
lmiterm([-5 2 1 R],1,1);
lmiterm([-5 2 2 0],1/beta1);

mylmi = getlmis;

[tmin, psol] = feasp(mylmi);
assert(tmin < 0)

Q = dec2mat(mylmi, psol, Q)
R = dec2mat(mylmi, psol, R)
F = R*inv(Q);

M = Ac + Bc*F;
eig(M)
assert(all(eig(M)<0))

end